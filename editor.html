<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Pixel Art Ajustable</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .editor-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            justify-content: center;
        }
        
        .canvas-container {
            flex: 1;
            min-width: 300px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .pixel-grid {
            display: grid;
            width: 320px;
            height: 320px;
            border: 2px solid #555;
            background-color: #222;
            margin-bottom: 15px;
            /* background-image: 
                linear-gradient(45deg, #333 25%, transparent 25%),
                linear-gradient(-45deg, #333 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #333 75%),
                linear-gradient(-45deg, transparent 75%, #333 75%); */
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        .pixel {
            border: 1px solid rgba(51, 51, 51, 0.3);
            cursor: pointer;
            transition: transform 0.1s;
        }
        
        .pixel:hover {
            transform: scale(1.1);
            z-index: 1;
            position: relative;
        }
        
        .tools-container {
            flex: 1;
            min-width: 250px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s, border-color 0.2s;
        }
        
        .color:hover {
            transform: scale(1.2);
        }
        
        .color.active {
            border-color: white;
            transform: scale(1.2);
        }
        
        .custom-color {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        #color-picker {
            width: 50px;
            height: 50px;
            border: none;
            background: transparent;
            cursor: pointer;
        }
        
        .tool-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #4a4a9c;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #5a5aac;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .export-btn {
            background-color: #2e7d32;
            width: 100%;
            padding: 12px;
            font-size: 1.1rem;
            margin-top: 10px;
        }
        
        .export-btn:hover {
            background-color: #3e8d42;
        }
        
        .preview {
            margin-top: 20px;
            text-align: center;
        }
        
        #preview-canvas {
            border: 2px solid #555;
            background-color: #222;
            margin-top: 10px;
            image-rendering: pixelated;
            /* background-image: 
                linear-gradient(45deg, #333 25%, transparent 25%),
                linear-gradient(-45deg, #333 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #333 75%),
                linear-gradient(-45deg, transparent 75%, #333 75%); */
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        .grid-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        .grid-slider {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: #4a4a9c;
            border-radius: 5px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
        }
        
        footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .editor-container {
                flex-direction: column;
            }
            
            .pixel-grid {
                width: 280px;
                height: 280px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Editor de Pixel Art</h1>
            <p class="subtitle">Crea arte pixelado con fondo transparente</p>
        </header>
        
        <div class="editor-container">
            <div class="canvas-container">
                <h2 class="section-title">Lienzo</h2>
                
                <div class="grid-controls">
                    <label for="grid-size">Tamaño de la cuadrícula: <span id="grid-size-value">32</span>x<span id="grid-size-value2">32</span></label>
                    <div class="grid-slider">
                        <span class="slider-value">8</span>
                        <input type="range" id="grid-size" min="8" max="64" value="32" step="8">
                        <span class="slider-value">64</span>
                    </div>
                </div>
                
                <div class="pixel-grid" id="pixel-grid"></div>
                <div class="tool-buttons">
                    <button id="clear-btn">Limpiar</button>
                    <button id="fill-btn">Rellenar</button>
                    <button id="eraser-btn">Borrador</button>
                </div>
            </div>
            
            <div class="tools-container">
                <h2 class="section-title">Herramientas</h2>
                
                <div class="color-palette" id="color-palette"></div>
                
                <div class="custom-color">
                    <label for="color-picker">Color personalizado:</label>
                    <input type="color" id="color-picker" value="#ff0000">
                </div>
                
                <div class="tool-buttons">
                    <button id="save-btn">Guardar</button>
                    <button id="load-btn">Cargar</button>
                </div>
                
                <button class="export-btn" id="export-btn">Exportar Imagen (PNG)</button>
                
                <div class="preview">
                    <h3 class="section-title">Vista Previa</h3>
                    <canvas id="preview-canvas" width="160" height="160"></canvas>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Editor de Pixel Art &copy; 2023 - Haz clic en los píxeles para dibujar</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Configuración inicial
            let gridSize = 32;
            const canvasSize = 320;
            let currentColor = '#ff0000';
            let isDrawing = false;
            let isErasing = false;
            
            // Elementos del DOM
            const pixelGrid = document.getElementById('pixel-grid');
            const colorPalette = document.getElementById('color-palette');
            const colorPicker = document.getElementById('color-picker');
            const clearBtn = document.getElementById('clear-btn');
            const fillBtn = document.getElementById('fill-btn');
            const eraserBtn = document.getElementById('eraser-btn');
            const saveBtn = document.getElementById('save-btn');
            const loadBtn = document.getElementById('load-btn');
            const exportBtn = document.getElementById('export-btn');
            const previewCanvas = document.getElementById('preview-canvas');
            const previewCtx = previewCanvas.getContext('2d');
            const gridSizeSlider = document.getElementById('grid-size');
            const gridSizeValue = document.getElementById('grid-size-value');
            const gridSizeValue2 = document.getElementById('grid-size-value2');
            
            // Paleta de colores predefinidos
            const colors = [
                '#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff',
                '#ffffff', '#000000', '#ffa500', '#800080', '#ffc0cb', '#a52a2a',
                '#808080', '#ffd700', '#008000', '#000080', '#800000', '#ff7f50'
            ];
            
            // Estado del lienzo
            let gridState = [];
            
            // Inicializar la paleta de colores
            function initColorPalette() {
                colorPalette.innerHTML = '';
                
                colors.forEach(color => {
                    const colorElement = document.createElement('div');
                    colorElement.className = 'color';
                    colorElement.style.backgroundColor = color;
                    colorElement.addEventListener('click', () => {
                        setCurrentColor(color);
                    });
                    colorPalette.appendChild(colorElement);
                });
                
                // Establecer el primer color como activo
                setCurrentColor(colors[0]);
            }
            
            // Establecer el color actual
            function setCurrentColor(color) {
                currentColor = color;
                colorPicker.value = color;
                
                // Actualizar estado activo en la paleta
                document.querySelectorAll('.color').forEach(el => {
                    el.classList.remove('active');
                    if (el.style.backgroundColor === color || 
                        rgbToHex(el.style.backgroundColor) === color) {
                        el.classList.add('active');
                    }
                });
                
                isErasing = false;
                eraserBtn.textContent = 'Borrador';
            }
            
            // Convertir RGB a HEX
            function rgbToHex(rgb) {
                if (!rgb) return '';
                
                const result = rgb.match(/\d+/g);
                if (!result) return '';
                
                return '#' + result.map(x => {
                    const hex = parseInt(x).toString(16);
                    return hex.length === 1 ? '0' + hex : hex;
                }).join('');
            }
            
            // Inicializar la cuadrícula de píxeles
            function initPixelGrid() {
                // Inicializar el estado de la cuadrícula
                gridState = Array(gridSize).fill().map(() => Array(gridSize).fill('transparent'));
                
                // Calcular el tamaño de cada píxel
                const pixelSize = canvasSize / gridSize;
                
                // Configurar la cuadrícula
                pixelGrid.innerHTML = '';
                pixelGrid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
                pixelGrid.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
                
                for (let y = 0; y < gridSize; y++) {
                    for (let x = 0; x < gridSize; x++) {
                        const pixel = document.createElement('div');
                        pixel.className = 'pixel';
                        pixel.style.backgroundColor = gridState[y][x];
                        pixel.dataset.x = x;
                        pixel.dataset.y = y;
                        
                        pixel.addEventListener('mousedown', (e) => {
                            isDrawing = true;
                            drawPixel(x, y, e.shiftKey);
                        });
                        
                        pixel.addEventListener('mouseover', () => {
                            if (isDrawing) {
                                drawPixel(x, y);
                            }
                        });
                        
                        pixelGrid.appendChild(pixel);
                    }
                }
                
                // Actualizar vista previa
                updatePreview();
            }
            
            // Dibujar un píxel
            function drawPixel(x, y, isErasingOverride = false) {
                const color = (isErasing || isErasingOverride) ? 'transparent' : currentColor;
                gridState[y][x] = color;
                
                const pixel = document.querySelector(`.pixel[data-x="${x}"][data-y="${y}"]`);
                if (pixel) {
                    pixel.style.backgroundColor = color;
                }
                
                updatePreview();
            }
            
            // Actualizar la vista previa
            function updatePreview() {
                const previewSize = 160;
                const scale = previewSize / gridSize;
                
                // Limpiar el canvas con patrón de tablero de ajedrez para transparencia
                previewCtx.fillStyle = '#222';
                previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);
                
                // Dibujar patrón de transparencia
                const squareSize = 10;
                // for (let y = 0; y < previewSize; y += squareSize * 2) {
                //     for (let x = 0; x < previewSize; x += squareSize * 2) {
                //         previewCtx.fillStyle = '#333';
                //         previewCtx.fillRect(x, y, squareSize, squareSize);
                //         previewCtx.fillRect(x + squareSize, y + squareSize, squareSize, squareSize);
                //     }
                // }
                
                // Dibujar cada píxel en la vista previa
                for (let y = 0; y < gridSize; y++) {
                    for (let x = 0; x < gridSize; x++) {
                        if (gridState[y][x] !== 'transparent') {
                            previewCtx.fillStyle = gridState[y][x];
                            previewCtx.fillRect(x * scale, y * scale, scale, scale);
                        }
                    }
                }
            }
            
            // Limpiar el lienzo
            function clearCanvas() {
                gridState = Array(gridSize).fill().map(() => Array(gridSize).fill('transparent'));
                initPixelGrid();
            }
            
            // Rellenar el lienzo con el color actual
            function fillCanvas() {
                gridState = Array(gridSize).fill().map(() => Array(gridSize).fill(currentColor));
                initPixelGrid();
            }
            
            // Alternar el borrador
            function toggleEraser() {
                isErasing = !isErasing;
                eraserBtn.textContent = isErasing ? 'Borrador (ON)' : 'Borrador';
            }

            function initState() {
                gridSize = 32;
                gridState = Array(gridSize).fill().map(() => Array(gridSize).fill('transparent'));
                saveState();
            }
            
            // Guardar el estado actual
            function saveState() {
                const stateToSave = {
                    gridSize: gridSize,
                    gridState: gridState
                };
                localStorage.setItem('pixelArtState', JSON.stringify(stateToSave));
                alert('¡Diseño guardado correctamente!');
            }
            
            // Cargar un estado guardado - CORREGIDO
            function loadState() {
                const savedState = localStorage.getItem('pixelArtState');
                if (savedState) {
                    try {
                        const state = JSON.parse(savedState);
                        
                        // Verificar que el estado tenga la estructura correcta
                        if (state && state.gridSize && state.gridState) {
                            gridSize = state.gridSize;
                            gridState = state.gridState;
                            
                            // Actualizar controles de la interfaz
                            gridSizeSlider.value = gridSize;
                            gridSizeValue.textContent = gridSize;
                            gridSizeValue2.textContent = gridSize;
                            
                            // Recrear la cuadrícula con el nuevo estado
                            recreatePixelGrid();
                            
                            // alert('¡Diseño cargado correctamente!');
                        } else {
                            alert('Error: El diseño guardado tiene un formato incorrecto.');
                            initState();
                        }
                    } catch (e) {
                        alert('Error al cargar el diseño: ' + e.message);
                    }
                } else {
                    alert('No hay diseños guardados.');
                    initState()
                }
            }
            
            // Función para recrear la cuadrícula con un estado cargado
            function recreatePixelGrid() {
                // Configurar la cuadrícula
                pixelGrid.innerHTML = '';
                pixelGrid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
                pixelGrid.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
                
                for (let y = 0; y < gridSize; y++) {
                    for (let x = 0; x < gridSize; x++) {
                        const pixel = document.createElement('div');
                        pixel.className = 'pixel';
                        // Asegurarse de que el color sea válido
                        pixel.style.backgroundColor = gridState[y][x] || 'transparent';
                        pixel.dataset.x = x;
                        pixel.dataset.y = y;
                        
                        pixel.addEventListener('mousedown', (e) => {
                            isDrawing = true;
                            drawPixel(x, y, e.shiftKey);
                        });
                        
                        pixel.addEventListener('mouseover', () => {
                            if (isDrawing) {
                                drawPixel(x, y);
                            }
                        });
                        
                        pixelGrid.appendChild(pixel);
                    }
                }
                
                // Actualizar vista previa
                updatePreview();
            }
            
            // Exportar la imagen
            function exportImage() {
                const exportCanvas = document.createElement('canvas');
                exportCanvas.width = gridSize * 10; // 10px por píxel
                exportCanvas.height = gridSize * 10;
                const exportCtx = exportCanvas.getContext('2d');
                
                // Hacer el fondo transparente
                exportCtx.clearRect(0, 0, exportCanvas.width, exportCanvas.height);
                
                // Dibujar cada píxel en el canvas de exportación
                for (let y = 0; y < gridSize; y++) {
                    for (let x = 0; x < gridSize; x++) {
                        if (gridState[y][x] !== 'transparent') {
                            exportCtx.fillStyle = gridState[y][x];
                            exportCtx.fillRect(x * 10, y * 10, 10, 10);
                        }
                    }
                }
                
                // Crear un enlace de descarga
                const link = document.createElement('a');
                link.download = 'pixel-art.png';
                link.href = exportCanvas.toDataURL('image/png');
                link.click();
            }
            
            // Cambiar el tamaño de la cuadrícula
            function changeGridSize() {
                gridSize = parseInt(gridSizeSlider.value);
                gridSizeValue.textContent = gridSize;
                gridSizeValue2.textContent = gridSize;
                initPixelGrid();
            }
            
            // Event Listeners
            colorPicker.addEventListener('input', (e) => {
                setCurrentColor(e.target.value);
            });
            
            clearBtn.addEventListener('click', clearCanvas);
            fillBtn.addEventListener('click', fillCanvas);
            eraserBtn.addEventListener('click', toggleEraser);
            saveBtn.addEventListener('click', saveState);
            loadBtn.addEventListener('click', loadState);
            exportBtn.addEventListener('click', exportImage);
            gridSizeSlider.addEventListener('input', changeGridSize);
            
            // Detener el dibujo cuando se suelta el mouse
            document.addEventListener('mouseup', () => {
                isDrawing = false;
            });
            
            // Inicializar la aplicación
            initColorPalette();
            initPixelGrid();
            loadState();
        });
    </script>
</body>
</html>